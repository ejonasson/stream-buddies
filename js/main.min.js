function queryTwitch(){Twitch.init({clientId:"cbmag59uju3vb9fevpi2de3pank5wtg"},function(){$.ajax({url:followsUrl,type:"GET",contentType:"application/json",dataType:"jsonp",cache:!0,error:function(){},success:function(data){return 404===data.status?($("#header-message").html(error.invalidUser),state.showingStream=!0,!1):void useStreams(data)}})})}function showOnline(streamArray){var name=streamArray.name,userURL=streamUrl+name;$.ajax({url:userURL,type:"GET",contentType:"application/json",dataType:"jsonp",cache:!0,success:function(data){var streamObj={channelName:streamArray.name,viewerCount:viewerCount(data.stream),game:streamArray.game,status:streamArray.status,logo:streamArray.logo,logoid:streamArray.name+"-logo",display_name:streamArray.display_name,online:!1,already_loaded:!1,metaID:streamArray.name+"-meta",viewers:removeBadData(data.stream)};null!==data.stream&&(streamObj.online=!0),addStream(streamObj)}})}function removeBadData(data){return null===data?0:data.viewers}function addStream(streamObj){var loaded=!1,thisStreamID="#"+streamObj.channelName;for(var i in loadedStreams)loadedStreams[i].channelName===streamObj.channelName&&(loadedStreams[i].online!==streamObj.online?($(thisStreamID).remove(),streamObj.already_loaded=!1,loadedStreams[i]=streamObj):(streamObj.already_loaded=!0,loadedStreams[i]=streamObj),loaded=!0);loaded||loadedStreams.push(streamObj)}function sortLoaded(a,b){return a.viewers===b.viewers?0:b.viewers>a.viewers?1:-1}function loadStreamFromObject(){loadedStreams.sort(sortLoaded);for(var i in loadedStreams)if(loadedStreams[i].already_loaded);else{var source=$("#stream-lister").html(),template=Handlebars.compile(source),thisStream=loadedStreams[i];loadedStreams[i].online?($("#streamer-list").append(template(thisStream)),loadFirstStream(loadedStreams[i]),addStreamerImage(thisStream)):(source=$("#offline-stream-lister").html(),template=Handlebars.compile(source),$("#offline-list").append(template(thisStream)),addStreamerImage(thisStream)),loadedStreams[i].already_loaded=!0}}function refreshStreamData(){for(var i in loadedStreams)if(loadedStreams[i].already_loaded){var source=$("#stream-refresh").html(),template=Handlebars.compile(source),thisStream=loadedStreams[i],thisStreamID="#"+thisStream.channelName;$(thisStreamID).html(template(thisStream)),addStreamerImage(thisStream)}}function addStreamerImage(streamObj){var id="#"+streamObj.logoid,url="url("+streamObj.logo+")";$(id).css("background-image",url)}function loadFirstStream(streamObj){var getFirstStreamID=$("#streamer-list > :first-child").attr("id");if(getFirstStreamID==streamObj.channelName&&!state.showingStream){var FirstOnlineStreamID="#"+getFirstStreamID;state.showingStream=!0,changeStream(streamObj.channelName),$(FirstOnlineStreamID).addClass("selected-stream")}}function changeStream(streamer){var source=$("#stream-embed").html(),template=Handlebars.compile(source),chatSource=$("#stream-chat-embed").html(),chatTemplate=Handlebars.compile(chatSource);for(var i in loadedStreams)if(loadedStreams[i].channelName===streamer){var streamObj=loadedStreams[i];$("#stream-area").html(template(streamObj)),$("#stream-chat-area").html(chatTemplate(streamObj)),resetDivWidth()}}function noStreams(){state.showingStream||$("#header-message").html(loadedStreams.length>0?error.notFound:error.twitchError)}function resetDivWidth(){var sidebar=$("#streamer-list").width(),chat=$("#stream-chat-area").width(),wrapper=$(".wrapper").width(),padding=50,computedWidth=wrapper-chat-sidebar-padding,computedHeight=Math.floor(.61*computedWidth);$("#stream-area").width(computedWidth),$("#stream-area").height(computedHeight)}function getQueryVariable(variable){for(var query=window.location.search.substring(1),vars=query.split("&"),i=0;i<vars.length;i++){var pair=vars[i].split("=");if(pair[0]==variable)return pair[1]}return!1}function findUser(){var username="spartanerk",queryname=getQueryVariable("name");return queryname?queryname:username}function useStreams(followedStream){var follows=followedStream.follows;for(var i in follows){var streamArray=follows[i].channel;showOnline(streamArray)}}function viewerCount(data){if(null!==data){if(1==data.viewers){var string="1 viewer";return string}var viewString=data.viewers+" viewers";return viewString}return null}function fullOrMinStreams(){var widthChange=0,list=$(".streamer-list");list.width()===dimension.streamBoxWidth?(widthChange=65,list.is(":animated")||$(".streamer-list").animate({width:widthChange},100,function(){resetDivWidth(),$(".stream-box").css("left",widthChange),$(".hide-small").css("display","none"),$(".show-small").css("display","inline")})):(widthChange=dimension.streamBoxWidth,list.is(":animated")||$(".streamer-list").animate({width:widthChange},100,function(){resetDivWidth(),$(".stream-box").css("left",dimension.streamBoxWidth),$(".hide-small").css("display","inline"),$(".show-small").css("display","none")}))}var loadedStreams=[],theUser=findUser(),theURL="https://api.twitch.tv/kraken/",followsUrl=theURL+"users/"+theUser+"/follows/channels",streamUrl=theURL+"streams/",dimension={streamBoxWidth:315,streamChatWidth:270},state={showingStream:!1,toggleOverride:!1},error={notFound:"No Online Streams were found.",twitchError:"Twitch is taking longer than expected to respond. Try refreshing your browser.",invalidUser:"Error: We could not find a Twitch account by that name. Please check to make sure the name is spelled correctly."};$(document).ready(function(){queryTwitch(),setInterval(queryTwitch,1e5),setTimeout(loadStreamFromObject,700),setInterval(loadStreamFromObject,1200),setInterval(refreshStreamData,1e5),setTimeout(noStreams,7e3),$(document).on("click",".streamer",function(){$(".selected-stream").removeClass("selected-stream"),$(this).addClass("selected-stream");var streamerID=this.getAttribute("id");changeStream(streamerID)}),resetDivWidth(),$(window).resize(function(){resetDivWidth(),state.toggleOverride||($(window).width()<1200&&$(".streamer-list").width()>100&&fullOrMinStreams(),$(window).width()>=1200&&$(".streamer-list").width()<100&&fullOrMinStreams())}),$("#stream-filter").keyup(function(){var filterBox=$("#stream-filter").val(),expression=filterBox,regFilter=new RegExp(expression,"i");for(var i in loadedStreams){var channelID="#"+loadedStreams[i].channelName;$(channelID).show()}for(var i in loadedStreams){var stream=loadedStreams[i];if(!regFilter.test(stream.channelName)&&!regFilter.test(stream.status)){var channelID="#"+loadedStreams[i].channelName;$(channelID).hide()}}}),$(document).on("click","#chat-toggle",function(){var chat=$("#stream-chat-area");chat.width()===dimension.streamChatWidth?(chat.width(0),chat.css("display","none")):(chat.width(dimension.streamChatWidth),chat.css("display","inline-block")),resetDivWidth()}),$(document).on("click",".show-hide-streams",function(){state.toggleOverride=!0,fullOrMinStreams()})});